<!DOCTYPE html>

<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>EagleLearn ‚Äì Multiply & Divide</title>

<style>
body{
    font-family: Arial, sans-serif;
    margin:0;
    background:linear-gradient(135deg,#0b1f3a,#1f3b73,#b8860b);
    color:#fff;
    text-align:center;
    overflow-x:hidden;
}

.screen{ padding:30px; }
.hidden{ display:none; }

button{
    padding:15px 25px;
    margin:10px;
    font-size:18px;
    border:none;
    border-radius:10px;
    cursor:pointer;
}

.modeBtn{ background:#b8860b;color:#000; font-weight:bold; }
.levelBtn{ background:#1f3b73;color:#fff; }

.correct{ color:lime; }
.incorrect{ color:#ff8080; }

.bubble-container{
    display:flex;
    flex-wrap:wrap;
    justify-content:center;
    gap:20px;
    margin-top:30px;
    min-height:120px;
}

.answer-bubble{
    width:90px;
    height:90px;
    border-radius:50%;
    background:radial-gradient(circle,#b8860b,#8b6508);
    display:flex;
    align-items:center;
    justify-content:center;
    font-size:24px;
    font-weight:bold;
    cursor:pointer;
    transition:0.3s;
    animation:float 4s ease-in-out infinite;
}

.answer-bubble:hover{
    transform:scale(1.15);
}

@keyframes float{
    0%{transform:translateY(0px);}
    50%{transform:translateY(-10px);}
    100%{transform:translateY(0px);}
}

canvas{
    background:#87ceeb;
    border-radius:10px;
}

.mode-selection{
    margin: 30px 0;
}

.mode-card{
    display: inline-block;
    background: rgba(31,59,115,0.5);
    border: 3px solid #b8860b;
    border-radius: 15px;
    padding: 25px;
    margin: 15px;
    min-width: 180px;
    cursor: pointer;
    transition: 0.3s;
}

.mode-card:hover{
    transform: scale(1.05);
    box-shadow: 0 8px 25px rgba(184,134,11,0.5);
}

.mode-card.selected{
    background: #b8860b;
    color: #000;
}

.mode-card .emoji{
    font-size: 48px;
    display: block;
    margin-bottom: 10px;
}
</style>

</head>

<body>

<!-- MENU -->

<div class="screen" id="menuScreen">
<h1>ü¶Ö EagleLearn</h1>

<div class="mode-selection">
    <h2>Choose Mode</h2>
    <div class="mode-card" onclick="selectModeAndContinue('multiply')">
        <span class="emoji">‚úñÔ∏è</span>
        <h3>Multiply</h3>
    </div>
    <div class="mode-card" onclick="selectModeAndContinue('divide')">
        <span class="emoji">‚ûó</span>
        <h3>Divide</h3>
    </div>
</div>

<div id="level-selection" class="hidden">
    <h2>Select Level (1-10)</h2>
    <div id="levels"></div>
</div>

<h2>üèÜ Top Eagle Scores</h2>
<div id="leaderboard"></div>

</div>

<!-- GAME -->

<div class="screen hidden" id="gameScreen">
<h2 id="modeTitle"></h2>
<div id="medals" style="font-size:28px;margin-bottom:15px;"></div>
<h3 id="question"></h3>
<div id="bubbleContainer" class="bubble-container"></div>
<p id="feedback"></p>
<button onclick="backToMenu()">Back</button>
</div>

<!-- MINI GAME -->

<div class="screen hidden" id="miniGameScreen">
<h2>ü¶Ö Eagle Challenge!</h2>
<canvas id="flappyCanvas"></canvas>
</div>

<script>

let currentMode="multiply";
let currentLevel=1;
let correctAnswer;
let correctCount=0;
let medalsEarned=[];
let combo=0;
let bonusActive=false;

const userKey="eagleLearnMedals";

const correctSound=new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
const funnyWrongSound=new Audio("https://actions.google.com/sounds/v1/cartoon/boing.ogg");
const flapSound=new Audio("https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg");

function loadProgress(){
    const saved=localStorage.getItem(userKey);
    if(saved){
        const data=JSON.parse(saved);
        correctCount=data.correctCount||0;
        medalsEarned=data.medalsEarned||[];
    }
}

function saveProgress(){
    localStorage.setItem(userKey,JSON.stringify({correctCount,medalsEarned}));
}

function displayMedals(){
    document.getElementById("medals").innerHTML=medalsEarned.join(" ");
}

function checkMedals(){
    const medalLevels=[
        {count:5,icon:"ü•â"},
        {count:15,icon:"ü•à"},
        {count:30,icon:"ü•á"},
        {count:50,icon:"ü¶Ö"}
    ];

    medalLevels.forEach(m=>{
        if(correctCount===m.count){
            medalsEarned.push(m.icon);
            saveProgress();
            displayMedals();
            startMiniGame(m.count===50);
        }
    });
}

function selectModeAndContinue(mode){ 
    currentMode=mode; 
    
    // Highlight selected mode
    document.querySelectorAll('.mode-card').forEach(card => {
        card.classList.remove('selected');
    });
    event.target.closest('.mode-card').classList.add('selected');
    
    // Show level selection
    document.getElementById('level-selection').classList.remove('hidden');
}

function buildLevels(){
    const container=document.getElementById("levels");
    container.innerHTML = ''; // Clear existing
    for(let i=1;i<=10;i++){
        const btn=document.createElement("button");
        btn.className="levelBtn";
        btn.textContent="Level "+i;
        btn.onclick=()=>startGame(i);
        container.appendChild(btn);
    }
}


function startGame(level){
    currentLevel=level;
    document.getElementById("menuScreen").classList.add("hidden");
    document.getElementById("gameScreen").classList.remove("hidden");

    document.getElementById("modeTitle").textContent=
        currentMode==="multiply"?
        "Multiplication - Level "+level:
        "Division - Level "+level;

    nextQuestion();
}

function nextQuestion(){
    let num1,num2;

    if(currentMode==="multiply"){
        num1=currentLevel;
        num2=Math.floor(Math.random()*10)+1;
        correctAnswer=num1*num2;
        document.getElementById("question").textContent=
            num1+" √ó "+num2+" = ?";
    }else{
        num2=currentLevel;
        correctAnswer=Math.floor(Math.random()*10)+1;
        num1=correctAnswer*num2;
        document.getElementById("question").textContent=
            num1+" √∑ "+num2+" = ?";
    }

    generateAnswerBubbles();
    document.getElementById("feedback").textContent="";
}

function generateAnswerBubbles(){
    const container=document.getElementById("bubbleContainer");
    container.innerHTML="";

    let answers=[correctAnswer];

    while(answers.length<6){
        let wrong=correctAnswer+Math.floor(Math.random()*12)-6;
        if(wrong>0&&!answers.includes(wrong)){
            answers.push(wrong);
        }
    }

    answers.sort(()=>Math.random()-0.5);

    answers.forEach(ans=>{
        const bubble=document.createElement("div");
        bubble.className="answer-bubble";
        bubble.textContent=ans;
        bubble.onclick=()=>checkAnswer(ans,bubble);
        container.appendChild(bubble);
    });
}

function checkAnswer(user,bubble){
    if(user===correctAnswer){
        correctSound.currentTime=0;
        correctSound.play();

        combo++;
        let points=bonusActive?2:1;
        correctCount+=points;

        bubble.style.transform="scale(1.5)";
        bubble.style.opacity="0";

        checkMedals();

        document.getElementById("feedback").textContent=
            "ü¶Ö Correct! Combo x"+combo;

        setTimeout(nextQuestion,900);

    }else{
        funnyWrongSound.currentTime=0;
        funnyWrongSound.play();
        combo=0;
        document.getElementById("feedback").textContent="üòÑ Try again!";
    }
}

function backToMenu(){
    document.getElementById("gameScreen").classList.add("hidden");
    document.getElementById("menuScreen").classList.remove("hidden");
    
    // Reset mode selection display
    document.querySelectorAll('.mode-card').forEach(card => {
        card.classList.remove('selected');
    });
    document.getElementById('level-selection').classList.add('hidden');
}

/* ================= MINI GAME ================= */
function startMiniGame(isBoss=false){

    document.getElementById("gameScreen").classList.add("hidden");
    document.getElementById("miniGameScreen").classList.remove("hidden");

    const canvas = document.getElementById("flappyCanvas");
    const ctx = canvas.getContext("2d");

    // üî• Make canvas full screen
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    let y = canvas.height / 2;
    let velocity = 0;
    let gravity = 0.5;   // softer gravity
    let flapPower = -10; // stronger flap

    let pipes = [];
    let lives = 3;
    let score = 0;

    let speed = isBoss ? 5 : 2.5;   // slower = easier
    let gap = isBoss ? 140 : 200;   // bigger gap = easier

    function spawnPipe(){
        pipes.push({
            x: canvas.width,
            top: Math.random() * (canvas.height - 300) + 50,
            passed: false
        });
    }

    let pipeInterval = setInterval(spawnPipe, 1800);

    function flap(){
        velocity = flapPower;
        flapSound.currentTime = 0;
        flapSound.play();
    }

    // üì± Touch only (prevents double-trigger on iPad)
    canvas.addEventListener("touchstart", flap);

    function loop(){

        ctx.clearRect(0,0,canvas.width,canvas.height);

        velocity += gravity;
        y += velocity;

        // ü¶Ö Bigger eagle
        ctx.font = "60px Arial";
        ctx.fillText("ü¶Ö", 100, y);

        pipes.forEach(pipe => {

            pipe.x -= speed;

            ctx.fillStyle = isBoss ? "red" : "#4a2f00";

            // Top pipe
            ctx.fillRect(pipe.x, 0, 80, pipe.top);

            // Bottom pipe
            ctx.fillRect(pipe.x, pipe.top + gap, 80, canvas.height);

            // Score
            if(!pipe.passed && pipe.x < 100){
                score++;
                pipe.passed = true;
            }

            // Collision detection
            if(100 + 40 > pipe.x && 100 < pipe.x + 80){
                if(y < pipe.top || y > pipe.top + gap){
                    lives--;
                    y = canvas.height / 2;
                    velocity = 0;
                    pipes = [];
                }
            }
        });

        // UI overlay
        ctx.fillStyle = "black";
        ctx.font = "24px Arial";
        ctx.fillText("Lives: " + lives, 20, 40);
        ctx.fillText("Score: " + score, canvas.width - 140, 40);

        if(lives <= 0){

            clearInterval(pipeInterval);
            canvas.removeEventListener("touchstart", flap);

            addScoreToLeaderboard(score);

            if(score >= 8){
                bonusActive = true;
                alert("üî• Bonus Mode Activated! Double points!");
            }

            setTimeout(()=>{
                document.getElementById("miniGameScreen").classList.add("hidden");
                document.getElementById("gameScreen").classList.remove("hidden");
            },1200);

            return;
        }

        requestAnimationFrame(loop);
    }

    loop();
}


    /* ================= LEADERBOARD ================= */

let leaderboard = [];
const leaderboardKey = "eagleLeaderboard";

function loadLeaderboard(){
    const saved = localStorage.getItem(leaderboardKey);
    if(saved){
        leaderboard = JSON.parse(saved);
    }
}

function saveLeaderboard(){
    localStorage.setItem(leaderboardKey, JSON.stringify(leaderboard));
}

function updateLeaderboardDisplay(){
    const board = document.getElementById("leaderboard");
    if(!board) return;

    if(leaderboard.length === 0){
        board.innerHTML = "<p>No scores yet!</p>";
        return;
    }

    board.innerHTML = leaderboard
        .map((score, index) => `<p>#${index+1} ‚Äî ${score}</p>`)
        .join("");
}

function addScoreToLeaderboard(score){
    leaderboard.push(score);
    leaderboard.sort((a,b)=>b-a);
    leaderboard = leaderboard.slice(0,5);
    saveLeaderboard();
    updateLeaderboardDisplay();
}


/* ================= INIT ================= */

document.addEventListener("DOMContentLoaded", function(){

    buildLevels();
    loadProgress();
    displayMedals();
    loadLeaderboard();
    updateLeaderboardDisplay();

});
</script>

</body>
</html>
