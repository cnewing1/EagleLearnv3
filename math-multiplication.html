<script>

let currentMode = "multiply";
let currentLevel = 1;
let correctAnswer;
let correctCount = 0;
let medalsEarned = [];

const correctSound = new Audio("https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg");
const funnyWrongSound = new Audio("https://actions.google.com/sounds/v1/cartoon/boing.ogg");

const userKey = "eagleLearnMedals";

function loadProgress(){
    const saved = localStorage.getItem(userKey);
    if(saved){
        const data = JSON.parse(saved);
        correctCount = data.correctCount || 0;
        medalsEarned = data.medalsEarned || [];
    }
}

function saveProgress(){
    localStorage.setItem(userKey, JSON.stringify({
        correctCount,
        medalsEarned
    }));
}

function displayMedals(){
    const medalDiv = document.getElementById("medals");
    if(!medalDiv) return;

    medalDiv.innerHTML = medalsEarned.join(" ");
}

function checkMedals(){
    const medalLevels = [
        {count:5, icon:"ü•â"},
        {count:15, icon:"ü•à"},
        {count:30, icon:"ü•á"},
        {count:50, icon:"ü¶Ö"}
    ];

    medalLevels.forEach(m=>{
        if(correctCount >= m.count && !medalsEarned.includes(m.icon)){
            medalsEarned.push(m.icon);
            alert("üèÖ New Medal Earned! " + m.icon);
        }
    });

    saveProgress();
    displayMedals();
}

function setMode(mode){
    currentMode = mode;
}

function buildLevels(){
    const container = document.getElementById("levels");
    for(let i=1;i<=10;i++){
        const btn=document.createElement("button");
        btn.className="levelBtn";
        btn.textContent="Level "+i;
        btn.onclick=()=>startGame(i);
        container.appendChild(btn);
    }
}
buildLevels();

function startGame(level){
    currentLevel = level;
    document.getElementById("menuScreen").classList.add("hidden");
    document.getElementById("gameScreen").classList.remove("hidden");

    document.getElementById("modeTitle").textContent =
        currentMode==="multiply" ?
        "Multiplication - Level "+level :
        "Division - Level "+level;

    nextQuestion();
}

function nextQuestion(){
    let num1,num2;

    if(currentMode==="multiply"){
        num1=currentLevel;
        num2=Math.floor(Math.random()*10)+1;
        correctAnswer=num1*num2;
        document.getElementById("question").textContent=
            num1+" √ó "+num2+" = ?";
    }else{
        num2=currentLevel;
        correctAnswer=Math.floor(Math.random()*10)+1;
        num1=correctAnswer*num2;
        document.getElementById("question").textContent=
            num1+" √∑ "+num2+" = ?";
    }

    document.getElementById("answer").value="";
    document.getElementById("feedback").textContent="";
}

function submitAnswer(){
    const user=parseInt(document.getElementById("answer").value);

    if(user===correctAnswer){
        correctSound.currentTime = 0;
        correctSound.play();

        correctCount++;
        checkMedals();

        document.getElementById("feedback").textContent="ü¶Ö Correct!";
        document.getElementById("feedback").className="correct";

        setTimeout(nextQuestion,1000);
    }else{
        funnyWrongSound.currentTime = 0;
        funnyWrongSound.play();

        document.getElementById("feedback").textContent=
            "üòÑ Oops! Answer: "+correctAnswer;
        document.getElementById("feedback").className="incorrect";
    }
}

function backToMenu(){
    document.getElementById("gameScreen").classList.add("hidden");
    document.getElementById("menuScreen").classList.remove("hidden");
}

loadProgress();
displayMedals();

</script>
